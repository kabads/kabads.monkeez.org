<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>rpm</title>
<!-- 2015-06-14 Sun 18:42 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">rpm</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. RPM</a>
<ul>
<li>
<ul>
<li><a href="#sec-1-0-1">1.0.1. Objectives</a></li>
</ul>
</li>
<li><a href="#sec-1-1">1.1. RPM</a></li>
<li><a href="#sec-1-2">1.2. Advantages of using RPM</a></li>
<li><a href="#sec-1-3">1.3. Package File Names</a></li>
<li><a href="#sec-1-4">1.4. Database Directory</a></li>
<li><a href="#sec-1-5">1.5. Helper Programs and Modifying Settings</a></li>
<li><a href="#sec-1-6">1.6. Queries</a></li>
<li><a href="#sec-1-7">1.7. Verifying Packages</a></li>
<li><a href="#sec-1-8">1.8. Installing Packages</a></li>
<li><a href="#sec-1-9">1.9. Uninstalling Packages</a></li>
<li><a href="#sec-1-10">1.10. Upgrading Packages</a></li>
<li><a href="#sec-1-11">1.11. Freshening packages</a></li>
<li><a href="#sec-1-12">1.12. Upgrading the kernel</a></li>
<li><a href="#sec-1-13">1.13. Using rpm2cpio</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> RPM</h2>
<div class="outline-text-2" id="text-1">
<p>
The Red Hat Package Manager (RPM) is used by a number of major distributions (and their close relatives) to control the installation, verification, upgrade and removal of software on linux systems. The low-level rpm program can perform all these operations, either on just one package, or on a list of packages. Operations which would cause problems (such as removing a package that another package depends on, or installing a package when the system needs other software to be installed first) are blocked from completion. 
</p>
</div>
<div id="outline-container-sec-1-0-1" class="outline-4">
<h4 id="sec-1-0-1"><span class="section-number-4">1.0.1</span> Objectives</h4>
<div class="outline-text-4" id="text-1-0-1">
<ul class="org-ul">
<li>Understand how the RPM system is organized and what major operations the rpm program can accomplish.
</li>
<li>Explain the naming conventions used for both binary and source rpm files.
</li>
<li>Know how to query, verify, install, uninstall, upgrade and freshen packages.
</li>
<li>Grasp why new kernels should be installed rather than upgraded.
</li>
<li>Know how to use rpm2cpio to copy packaged files in to a cpio archive, as well as to extract the files without installing them.
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1"><span class="section-number-3">1.1</span> RPM</h3>
<div class="outline-text-3" id="text-1-1">
<p>
The Red Hat Package Manager was developed unsurprisingly by Red Hat. All files related to a specific task are packaged in to a single rpm file, which also contains information about how and where to install and uninstall the files. New versions of software lead to new rpm files which are then used for updating. 
rpm files also contain dependency information. Note that unless given a specific URL to draw from, rpm in itself does not retrieve packages over the network and installs only from the local machine using absolute or relative paths. 
rpm files are usually distribution-dependent; installing a package on a different distribution than it was created for can be difficult if not impossible.
</p>
</div>
</div>
<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2"><span class="section-number-3">1.2</span> Advantages of using RPM</h3>
<div class="outline-text-3" id="text-1-2">
<p>
For system administrators, RPM makes it easy to:
</p>
<ul class="org-ul">
<li>Determine what package (if any) any file on the system is part of.
</li>
<li>Determine what version is installed.
</li>
<li>Install and uninstall (erase) packages without leaving debris behind.
</li>
<li>Verify that a package was installed correctly; this is useful for both trouble shooting and system auditing.
</li>
<li>Distinguish documentation files from the rest of the package and optionally decide not to install them to save space.
</li>
<li>Use ftp or HTTP to install packages over the internet.
</li>
</ul>
<p>
For developers RPM offers advantages as well:
</p>
<ul class="org-ul">
<li>Software often is made available on more than one operating system. With RPM the original full unmodified source is used as the basis, but a developer can separate out the changes needed to build on linux.
</li>
<li>More than one architecture can be built using only one source package.
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1-3" class="outline-3">
<h3 id="sec-1-3"><span class="section-number-3">1.3</span> Package File Names</h3>
<div class="outline-text-3" id="text-1-3">
<p>
RPM package file names are based on fields that represent specific information, as documented in the RPM standard (<a href="http://rpm.org">http://rpm.org</a>)
</p>
<ul class="org-ul">
<li>The standard naming format for a binary package is: 
</li>
</ul>
<p>
&lt;name&gt;-&lt;version&gt;-&lt;release&gt;.&lt;distro&gt;.&lt;architecture&gt;.rpm
sed-4.2.1-10.el6.x86<sub>64</sub>.rpm
</p>
<ul class="org-ul">
<li>The standard naming format for a source package is:
</li>
</ul>
<p>
&lt;name&gt;-&lt;version&gt;-&lt;release&gt;.&lt;distro&gt;.src.rpm
sed-4.2.1-10.el6.src.rpm
Note that the distro field often actually specifies the repository that the package came from, as a given installation may use a number of different pacakge repositories as we shall discuss when we discuss yum and zypper which work above RPM. 
</p>
</div>
</div>
<div id="outline-container-sec-1-4" class="outline-3">
<h3 id="sec-1-4"><span class="section-number-3">1.4</span> Database Directory</h3>
<div class="outline-text-3" id="text-1-4">
<p>
/var/lib/rpm is the default system directory which holds RPM database files in the form of Berkely DB hash files. The database files should not be manually modified, updates should be done only through use of the rpm program. 
An alternative database directory can be specified with the &#x2013;dbpath option to the rpm program. One might do this, for example, to examine an RPM database copied from another system. 
You can use the &#x2013;rebuilddb option to rebuild the database indices from the installed package headers; this is more a repair, and not a rebuild from scratch. 
</p>
</div>
</div>
<div id="outline-container-sec-1-5" class="outline-3">
<h3 id="sec-1-5"><span class="section-number-3">1.5</span> Helper Programs and Modifying Settings</h3>
<div class="outline-text-3" id="text-1-5">
<p>
Helper programs and scripts used by RPM reside in /usr/lib/rpm. There are quite a few; for example on a RHEL 7 system: 
$ ls /usr/lib/rpm | wc -l 
69
where wc is reporting the number of lines of output. 
You can create an rpmrc file to specify default settings for rpm. By default, rpm looks for:
</p>
<ol class="org-ol">
<li>/usr/lib/rpm/rpmrc
</li>
<li>/etc/rpmrc
</li>
<li>~/.rpmrc
</li>
</ol>
<p>
in the above order. Note all these files are read; rpm does not stop as soon as it finds that one exists. An alternative rpmrc file cna be specified using the &#x2013;rcfile option. 
</p>
</div>
</div>
<div id="outline-container-sec-1-6" class="outline-3">
<h3 id="sec-1-6"><span class="section-number-3">1.6</span> Queries</h3>
<div class="outline-text-3" id="text-1-6">
<p>
All rpm queries include the -q option, which can be combined with numerous sub-options as in: 
</p>
<ul class="org-ul">
<li>Which version of a package is installed? $ rmp -q bash
</li>
<li>Which package did this file come from? $ rpm -qf /bin/bash
</li>
<li>What files were installed by this package? $ rpm -ql bash
</li>
<li>Show information about this package. $ rpm -qi bash
</li>
<li>Show information about this package from the package file, not the package database. $ rpm -qip foo-1.0.0.1.noarch.rpm
</li>
<li>List all installed packages on this system. $ rpm -qa
</li>
</ul>
<p>
A couple of other useful options are &#x2013;requires and &#x2013;whatprovides. 
</p>
<ul class="org-ul">
<li>Return a list of prerequisites for a package: $ rpm -qp &#x2013;requires foo-1.0.0-1.noarch.rpm
</li>
<li>Show what installed package provides a particular requisite package: $ rpm -q &#x2013;whatprovides libc.so.6
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1-7" class="outline-3">
<h3 id="sec-1-7"><span class="section-number-3">1.7</span> Verifying Packages</h3>
<div class="outline-text-3" id="text-1-7">
<p>
The -v option to rpm allows you to verify whether the files from a particular package are consistent with the system's RPM database. To verify all paclages installed on the system: 
$ rpm -Va 
missing   /var/run/pluto
&#x2026;
showing just a few items. (Note this command can take a long time as it examines all files owned by packages). 
Output is generated only when there is a problem.
Each of the characteristics displayed above denotes the result of a comparison of attribute(s) of the file to the value of those attribute(s) recorded in the database. A single . (period) means the test passed, while a single ? (question mark) indicates the test could not be performed (e.g. file permissions prevent reading). Otherwise, the character denotes failure of the corresponding verification test:
</p>
<ul class="org-ul">
<li>S: file size differs
</li>
<li>M: file permissions and/or type differs
</li>
<li>5: MD5 checksum differs
</li>
<li>D: device major/minor number mismatch
</li>
<li>L: symbolic link path mismatch
</li>
<li>U: user ownership differs
</li>
<li>G: group ownership differs
</li>
<li>T: modification time differs
</li>
<li>P: capabilities differ
</li>
</ul>
<p>
Note that many of these verification tests do not indicate a problem. For example, many configuration files are modified as the system evolves.
If you specify one or more package names as an argument, you examine only that package as in the following examples:
</p>
<ul class="org-ul">
<li>No output when everything is OK: $ rpm -V bash
</li>
<li>Output indicating that a file's size, checksum, and modification time have changed: $ rpm -V talk
</li>
<li>Output indicating that a file is missing: $ rpm -V talk missing /usr/bin/talk
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1-8" class="outline-3">
<h3 id="sec-1-8"><span class="section-number-3">1.8</span> Installing Packages</h3>
<div class="outline-text-3" id="text-1-8">
<p>
Installing a package is as simple as:
$ sudo rpm -ivh foo-1.0.0-1.noarch.rpm
where the -i is fo install, -v is for verbose, and -h just means print out hash marks while doing to show progress. 
RPM performs a number of tasks when installing a packabge:
</p>
<ul class="org-ul">
<li>Performs dependency checks: Necessary because some packages will not operate properly unless one or more other packages are also installed.
</li>
<li>Performs conflict checks: Include attempts to install an already-installed package or to install an older version over a newer version.
</li>
<li>Executes commands required before installation: The developer building a package can specify that certain tasks be performed before or after the install.
</li>
<li>Deals intelligently with configuration files: When installing a configuration file, if the file exists and has been changed since the previous version of the package was installed, RPM saves the old version with the suffix .rpmsave. This allows you to integrate the changes you have made to the old configuration file into the newer version of the file. This feature depends on properly created RPM packages.
</li>
<li>Unpacks the files from packages and installs them with correct attributes: In addition to installing files in the right place, RPM also sets attributes such as permissions, ownership, and modification (build) time.
</li>
<li>Executes commands required after installation: Performs any post-install tasks required for setup or initialization.
</li>
<li>Updates the system RPM database: Every time RPM installs a package, it updates information in the system database. It uses this information when checking for conflicts. 
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1-9" class="outline-3">
<h3 id="sec-1-9"><span class="section-number-3">1.9</span> Uninstalling Packages</h3>
<div class="outline-text-3" id="text-1-9">
<p>
The -e option causes to uninstall (erase) a package. Normally, rpm -e fails with an error message if the package you are attempting to uninstall is either not actually installed, or is required by other packages on the system. A successful uninstall produces no output. 
$ sudo rpm -e system-config-lvm 
package system-config-lvm is not installed. 
Error due to dependencies:
$ sudo rpm -e xz 
error: Failed dependencies:&#x2026; 
You can use the &#x2013;test option along with -e to determine whether the uninstall would succeed or fail, without actually doing the uninstall. If the operation would be successful, rpm prints no output. Add the -vv option to get more information. 
Remember the package argument for the erase is the package name, not the rpm file name. 
<b>Important (but obvious) note</b>: Never remove (erase/uninstall) the rpm package itself. The only way to fix this problem is to re-install the operating system, or by booting in to a rescue environment. 
</p>
</div>
</div>
<div id="outline-container-sec-1-10" class="outline-3">
<h3 id="sec-1-10"><span class="section-number-3">1.10</span> Upgrading Packages</h3>
<div class="outline-text-3" id="text-1-10">
<p>
Upgrading replaces the original package (if installed) as in:
$ sudo rpm -Uvh bash-4.2.45-5.e17<sub>0</sub>.4.x86<sub>64</sub>.rpm
You can give a list of package names, not just one.
When upgrading, the already installed package is removed after the newer version is installed. The one exception is the configuration files from the original installation which are kept with a .rpmsave extension. 
If you use the -U option and the package is not already installed, it is simply installed and there is no error. 
The -i option is not designed for upgrades; attempting to install a new RPM package over an older one fails with error messages because it tries to overwrite existing system files. 
However different versions of the same package may be installed if each version of the package does not contain the same files: kernel packages and library packages from other architectures are typically the only packages that would be commonly installed multiple times. 
If you want to downgrade with rpm -U (that is, to replace the current version with an earlier version), you must add the &#x2013;oldpackage option to the command line.
</p>
</div>
</div>
<div id="outline-container-sec-1-11" class="outline-3">
<h3 id="sec-1-11"><span class="section-number-3">1.11</span> Freshening packages</h3>
<div class="outline-text-3" id="text-1-11">
<p>
The command: 
$ sudo rpm -Fvh <b>.rpm 
will attempt to *freshen</b> all the packages in the current directory. The way this works is: 
</p>
<ol class="org-ol">
<li>If an older version of a package is installed, it will be upgraded to the newer version in the directory.
</li>
<li>If the version on the system is the same as the one in the directory, nothing happens.
</li>
<li>If there is no version of a package installed, the package in the directory is ignored. 
</li>
</ol>
<p>
Freshening can be useful for applying a lot of patches (i.e., upgraded packages) at once. 
</p>
</div>
</div>
<div id="outline-container-sec-1-12" class="outline-3">
<h3 id="sec-1-12"><span class="section-number-3">1.12</span> Upgrading the kernel</h3>
<div class="outline-text-3" id="text-1-12">
<p>
When you install a new kernel on your system, it requires a reboot (one of the few updates that do) to take effect. You should not do an upgrade (-U) of a kernel: an upgrade would remove the old currently running kernel. 
This in and of itself won't stop the system, but if after you reboot you have any problems, you will no longer be able to reboot in to the old kernel since it has been removed from the system. However, if you install (-i), both kernels coexist and you can choose to boot in to either one; i.e. you can rever back to the old one if need be. 
To install a new kernel do: 
$ sudo rpm -ivh kernel-{version}.{arch}.rpm 
filling in the correct version and architecture names.
When you do this the <b>GRUB</b> configuration file will automatically be updated to include the new version; it will be the default choice at boot unless you reconfigure the system to do something else.
Once the new kernel version has been tested, you may remove the old version if you wish, though this is not necessary. Unless you are short on space, it is recommended that you keep one or more older kernels available.
</p>
</div>
</div>
<div id="outline-container-sec-1-13" class="outline-3">
<h3 id="sec-1-13"><span class="section-number-3">1.13</span> Using rpm2cpio</h3>
<div class="outline-text-3" id="text-1-13">
<p>
Suppose you have a need to extract files from an rpm but do not want to actually install the package?
The rpm2cpio program can be used to copy the files from an rpm to a cpio archive, and also extract the files if so desired. 
Create the cpio archive with: 
$ rpm2cpio foobar.rpm &gt; foobar.cpio
To list files in an rpm: 
$ rpm2cpio foobar.rpm | cpio -t 
but a better way is to do: 
$ rpm -qilp foobar.rpm
To extract on to the system:
$ rpm2cpio bash-4.2.45-5.el7<sub>0</sub>.4.x86<sub>64</sub>.rpm | cpio -ivd bin/bash
$ rpm2cpio foobar.rpm | cpio &#x2013;extract &#x2013;make-directories
</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Created: 2015-06-14 Sun 18:42</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 24.5.1 (<a href="http://orgmode.org">Org</a> mode 8.2.10)</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
