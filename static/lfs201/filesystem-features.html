<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>filesystem-features</title>
<!-- 2015-03-24 Tue 21:04 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">filesystem-features</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. Filesystem Features</a>
<ul>
<li><a href="#sec-1-1">1.1. Objectives</a>
<ul>
<li><a href="#sec-1-1-1">1.1.1. Be familiar with concepts such as inodes, directory files and extended attributes</a></li>
<li><a href="#sec-1-1-2">1.1.2. Create and format filesystems</a></li>
<li><a href="#sec-1-1-3">1.1.3. Check and fix errors on filesystems</a></li>
<li><a href="#sec-1-1-4">1.1.4. Mount and unmount filesystems</a></li>
</ul>
</li>
<li><a href="#sec-1-2">1.2. Inodes</a>
<ul>
<li><a href="#sec-1-2-1">1.2.1. Permissions</a></li>
<li><a href="#sec-1-2-2">1.2.2. User and group ownership</a></li>
<li><a href="#sec-1-2-3">1.2.3. Size</a></li>
<li><a href="#sec-1-2-4">1.2.4. Timestamps</a></li>
</ul>
</li>
<li><a href="#sec-1-3">1.3. Directory files</a>
<ul>
<li><a href="#sec-1-3-1">1.3.1. Hard links point to an inode</a></li>
<li><a href="#sec-1-3-2">1.3.2. Soft (or symbolic) links point to a file name which has an associated inode.</a></li>
</ul>
</li>
<li><a href="#sec-1-4">1.4. Extended Attributes and lsattr/chattr</a>
<ul>
<li><a href="#sec-1-4-1">1.4.1. i: immutable - A file with the immutable attribute (i) cannot be modified (not even by root). It cannot be deleted or renamed. No hard link can be created to it, and no data can be written to the file. Only the superuser can set or clear this attribute.</a></li>
<li><a href="#sec-1-4-2">1.4.2. a: append-only - A file with the append-only attribute (a) set can only be opened in append mode for writing. Only the superuser can set or clear this attribute.</a></li>
<li><a href="#sec-1-4-3">1.4.3. d: no-dump - A file with the no-dump attribute (d) set is ignored when the dump program is run. This is useful for swap and cache files that you don't want to waste time backing up.</a></li>
<li><a href="#sec-1-4-4">1.4.4. A:No atime update - A file with the no-atime-update (A) attribute set will not modify it's atime (access time) record when the file is accessed but not otherwise modified. This can increase the performance on some systems because it reduces the amount of disk I/O on the system.</a></li>
</ul>
</li>
<li><a href="#sec-1-5">1.5. Creating and formatting filesystems</a></li>
<li><a href="#sec-1-6">1.6. Checking and fixing filesystems</a></li>
<li><a href="#sec-1-7">1.7. Mounting and unmounting filesystems</a></li>
<li><a href="#sec-1-8">1.8. Mount</a>
<ul>
<li><a href="#sec-1-8-1">1.8.1. Mounts an ext4 filesystem</a></li>
<li><a href="#sec-1-8-2">1.8.2. The filesystem is located on a specific partition of the harddrive (/dev/sdb4)</a></li>
<li><a href="#sec-1-8-3">1.8.3. The filesystem is mounted at the position /home in the current directory tree.</a></li>
<li><a href="#sec-1-8-4">1.8.4. Any files residing in the original /home directory are hidden until the partiton is unmounted.</a></li>
</ul>
</li>
<li><a href="#sec-1-9">1.9. Mount options</a></li>
<li><a href="#sec-1-10">1.10. Unmount</a></li>
<li><a href="#sec-1-11">1.11. Mounting filesystems at boot</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Filesystem Features</h2>
<div class="outline-text-2" id="text-1">
<p>
Important filesystem features include inodes, directory files and hard and soft links. Extended attributes expand traditional UNIX file permissions. Filesystem-specific utilities perform tasks such as creating and formatting, checking for and fixing errors, and mounting and unmounting at boot or at later times. 
</p>
</div>
<div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1"><span class="section-number-3">1.1</span> Objectives</h3>
<div class="outline-text-3" id="text-1-1">
</div><div id="outline-container-sec-1-1-1" class="outline-4">
<h4 id="sec-1-1-1"><span class="section-number-4">1.1.1</span> Be familiar with concepts such as inodes, directory files and extended attributes</h4>
</div>
<div id="outline-container-sec-1-1-2" class="outline-4">
<h4 id="sec-1-1-2"><span class="section-number-4">1.1.2</span> Create and format filesystems</h4>
</div>
<div id="outline-container-sec-1-1-3" class="outline-4">
<h4 id="sec-1-1-3"><span class="section-number-4">1.1.3</span> Check and fix errors on filesystems</h4>
</div>
<div id="outline-container-sec-1-1-4" class="outline-4">
<h4 id="sec-1-1-4"><span class="section-number-4">1.1.4</span> Mount and unmount filesystems</h4>
</div>
</div>
<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2"><span class="section-number-3">1.2</span> Inodes</h3>
<div class="outline-text-3" id="text-1-2">
<p>
An inode is a data structure on disk that describes and stores file attributes, including a location. Every file is associated with its own inode. The information stored in the inode includes: 
</p>
</div>
<div id="outline-container-sec-1-2-1" class="outline-4">
<h4 id="sec-1-2-1"><span class="section-number-4">1.2.1</span> Permissions</h4>
</div>
<div id="outline-container-sec-1-2-2" class="outline-4">
<h4 id="sec-1-2-2"><span class="section-number-4">1.2.2</span> User and group ownership</h4>
</div>
<div id="outline-container-sec-1-2-3" class="outline-4">
<h4 id="sec-1-2-3"><span class="section-number-4">1.2.3</span> Size</h4>
</div>
<div id="outline-container-sec-1-2-4" class="outline-4">
<h4 id="sec-1-2-4"><span class="section-number-4">1.2.4</span> Timestamps</h4>
<div class="outline-text-4" id="text-1-2-4">
</div><ol class="org-ol"><li><a id="sec-1-2-4-1" name="sec-1-2-4-1"></a>Last access time<br  /></li>
<li><a id="sec-1-2-4-2" name="sec-1-2-4-2"></a>Last modification time<br  /></li>
<li><a id="sec-1-2-4-3" name="sec-1-2-4-3"></a>Change time<br  /><div class="outline-text-5" id="text-1-2-4-3">
<p>
Note: file names are not stored in a file's inode, but are instead stored in the directory file. 
All I/O activity concerning a file usually also involves the file's inode as information must be updated. 
</p>
</div>
</li></ol>
</div>
</div>
<div id="outline-container-sec-1-3" class="outline-3">
<h3 id="sec-1-3"><span class="section-number-3">1.3</span> Directory files</h3>
<div class="outline-text-3" id="text-1-3">
<p>
A directory file is a particular type of file that is used to associate file names and inodes. There are two ways to associate (or link) a file name with an inode:
</p>
</div>
<div id="outline-container-sec-1-3-1" class="outline-4">
<h4 id="sec-1-3-1"><span class="section-number-4">1.3.1</span> Hard links point to an inode</h4>
</div>
<div id="outline-container-sec-1-3-2" class="outline-4">
<h4 id="sec-1-3-2"><span class="section-number-4">1.3.2</span> Soft (or symbolic) links point to a file name which has an associated inode.</h4>
<div class="outline-text-4" id="text-1-3-2">
<p>
Each association of a directory file contents and an inode is known as a link. Additional links can be created using ln. 
Because it is possible (and common) for two or more directory entries to point to the same name (hard links), a file can be known by multiple names, each of which has its own place in the directory structure. However, itcan have only one inode no matter which name is being used. 
When a process refers to a pathname, the kernel searches directories to find the corresponding inode number. After the name has been converted in to an inode number, the inode is loaded in to memory and is used by subsequent requests. 
</p>
</div>
</div>
</div>
<div id="outline-container-sec-1-4" class="outline-3">
<h3 id="sec-1-4"><span class="section-number-3">1.4</span> Extended Attributes and lsattr/chattr</h3>
<div class="outline-text-3" id="text-1-4">
<p>
Extended attributes associate metadata not interpreted directly by the filesystem with files. Four namespaces exist: user, trusted, security and system. Later, we will see that the system namespace is used for access control lists (ACLs) and the security namespace is used by SELinux. 
Flag values are stored in the file inode and may be modified and set only by the root user. They are viewed with lsattr and set with chattr. 
In the user namespace flags may be set for files:
</p>
</div>
<div id="outline-container-sec-1-4-1" class="outline-4">
<h4 id="sec-1-4-1"><span class="section-number-4">1.4.1</span> i: immutable - A file with the immutable attribute (i) cannot be modified (not even by root). It cannot be deleted or renamed. No hard link can be created to it, and no data can be written to the file. Only the superuser can set or clear this attribute.</h4>
</div>
<div id="outline-container-sec-1-4-2" class="outline-4">
<h4 id="sec-1-4-2"><span class="section-number-4">1.4.2</span> a: append-only - A file with the append-only attribute (a) set can only be opened in append mode for writing. Only the superuser can set or clear this attribute.</h4>
</div>
<div id="outline-container-sec-1-4-3" class="outline-4">
<h4 id="sec-1-4-3"><span class="section-number-4">1.4.3</span> d: no-dump - A file with the no-dump attribute (d) set is ignored when the dump program is run. This is useful for swap and cache files that you don't want to waste time backing up.</h4>
</div>
<div id="outline-container-sec-1-4-4" class="outline-4">
<h4 id="sec-1-4-4"><span class="section-number-4">1.4.4</span> A:No atime update - A file with the no-atime-update (A) attribute set will not modify it's atime (access time) record when the file is accessed but not otherwise modified. This can increase the performance on some systems because it reduces the amount of disk I/O on the system.</h4>
</div>
</div>
<div id="outline-container-sec-1-5" class="outline-3">
<h3 id="sec-1-5"><span class="section-number-3">1.5</span> Creating and formatting filesystems</h3>
<div class="outline-text-3" id="text-1-5">
<p>
Every filesystem type has a utility for formatting (making a filesystem partition. The generic name for these utilities is mkfs. However, this is just a front-end for filesystem-specific programs:
$ ls -lh /sbin/mkfs* 
Thus the following two commands are entirely equivalent:
$ sudo mkfs -t ext4 /dev/sda10
$ sudo mkfs.ext4 /dev/sda10
The general format for mkfs is: 
mkfs [-t fstype] [options] [device-file]
where [device-file] is usually a device name like /dev/vq/lvm1
Each filesystem type has its own particular options that can be set when formatting. For example, when creating an ext4 filesystem, one thing to keep in mind are the journalling settings. These include defining the journal file size and whether or not to use an external journal file. 
One should look at the man page for each of the mkfs.* programs to see details. 
</p>
</div>
</div>
<div id="outline-container-sec-1-6" class="outline-3">
<h3 id="sec-1-6"><span class="section-number-3">1.6</span> Checking and fixing filesystems</h3>
<div class="outline-text-3" id="text-1-6">
<p>
Every filesystem type has a utility designed to check for errors (and hopefully fix any that are found.) The generic name for these utilities is fsck. However, this is just a front-end for filesystem-specific programs:
$ ls -l /sbin/fsck* 
Thus the following two commands are entirely equivalent:
$ sudo fsck -t ext4 /dev/sda10
$ sudo fsck.ext4 /dev/sda10
fsck is run automatically after a set number of mounts or a set interval since the last time it was run or after an abnormal shutdown. It should only be run on unmounted filesystems. You can force a check of all mounted filesystems at boot by doing: 
$ sudo touch /forcefsck
$ sudo reboot
</p>
</div>
</div>
<div id="outline-container-sec-1-7" class="outline-3">
<h3 id="sec-1-7"><span class="section-number-3">1.7</span> Mounting and unmounting filesystems</h3>
<div class="outline-text-3" id="text-1-7">
<p>
All accessible files in linux are organized in to one large hierarchical tree structure with the head of the tree being the root directory (/). However, it is common to have more than one partition (each of which can have its own filesystem type) joined together in the same filesystem tree. These partitions can also be on different physical devices, even on a network. 
The mount program allows attaching at any point in the tree structure; umount allows detaching them. 
The mount point is the directory where the filesystem is attached. It must exist before the mount can use it; mkdir can be used to create an empty directory. If a pre-existing directory is used and it contains files prior to being used as a mount point, they will be hidden after mounting. These files are not deleted and will again be visible when the filesystem is unmounted. 
Only the superuser can mount and unmount filesystems. 
</p>
</div>
</div>
<div id="outline-container-sec-1-8" class="outline-3">
<h3 id="sec-1-8"><span class="section-number-3">1.8</span> Mount</h3>
<div class="outline-text-3" id="text-1-8">
<p>
Each filesystem is mounted under a specific directory as in: 
$ sudo mount -t ext4 /dev/sdb4 /home
</p>
</div>
<div id="outline-container-sec-1-8-1" class="outline-4">
<h4 id="sec-1-8-1"><span class="section-number-4">1.8.1</span> Mounts an ext4 filesystem</h4>
</div>
<div id="outline-container-sec-1-8-2" class="outline-4">
<h4 id="sec-1-8-2"><span class="section-number-4">1.8.2</span> The filesystem is located on a specific partition of the harddrive (/dev/sdb4)</h4>
</div>
<div id="outline-container-sec-1-8-3" class="outline-4">
<h4 id="sec-1-8-3"><span class="section-number-4">1.8.3</span> The filesystem is mounted at the position /home in the current directory tree.</h4>
</div>
<div id="outline-container-sec-1-8-4" class="outline-4">
<h4 id="sec-1-8-4"><span class="section-number-4">1.8.4</span> Any files residing in the original /home directory are hidden until the partiton is unmounted.</h4>
<div class="outline-text-4" id="text-1-8-4">
<p>
Note that in this example, the filesystem is mounted by using the device node it resides on. However, it is also possible to mount using a label or UUID. Thus the following are all equivalent: 
$ sudo mount /dev/sda2 /home
$ sudo mount LABEL=home /home 
$ sudo mount -L home /home
$ sudo mount UUID=26d58ee2-9d20-4dc7-b6ab-aa87c3cfb69a /home
$sudo mount -U 26d58ee2-9d20-4dc7-b6ab-aa87c3cfb69a /home
Labels are assigned by filesystem type specific utilities such as e2label, and UUIDs are assigned when partitions are created as containers for the filesystem. 
While any three of the methods for specifying the device can be user, modern systems deprecate using the device node form because the names can change according to how the system is booted, which hard drives are found first, etc. Labels are an important improvement, but on rare occasions one could have two partitions that wind up with the same label. UUIDs however, should always be unique and are created when partitions are created. 
</p>
</div>
</div>
</div>
<div id="outline-container-sec-1-9" class="outline-3">
<h3 id="sec-1-9"><span class="section-number-3">1.9</span> Mount options</h3>
<div class="outline-text-3" id="text-1-9">
<p>
mount takes many options, such as generic ones like -a (moutn all filesystems mentioned in /etc/fstab) and many filesystem specific; it has a very long man page. A common example would be: 
$ sudo mount -o remount,ro /myfs 
whichi remounts a filesystem with a read-only attribute. 
To get a quick summary of mount options: 
$ mount &#x2013;help
</p>
</div>
</div>
<div id="outline-container-sec-1-10" class="outline-3">
<h3 id="sec-1-10"><span class="section-number-3">1.10</span> Unmount</h3>
<div class="outline-text-3" id="text-1-10">
<p>
Filesystems can be unmounted as in: 
$ umount [device-file| mount-point]
$ sudo umount /home
$ sudo umount /dev/sda3
Like mount, umount has many options which are specific to filesystem type. Once again, man pages are the best source for specific information. 
The most common error encountered when unmounting a filesystem is trying to do this on a filesystem currently in use; i.e. there are current applications using files or other entries in the filesystem. 
This can be as simple as having a terminal window open in a directory on the mounted filesystem. Just using cd in that window, or killing it, will get rid of the device is busy error and allow unmounting. 
However, if there are other processes inducing this error, you must kill them before unmounting the filesystem. You can use fuser to find out which users are using the filesystem and kill them (be careful with this, you may also want to warn users first). You can also use lsof (list open files) to try and see which files are being used and blocking unmounting. 
</p>
</div>
</div>
<div id="outline-container-sec-1-11" class="outline-3">
<h3 id="sec-1-11"><span class="section-number-3">1.11</span> Mounting filesystems at boot</h3>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Created: 2015-03-24 Tue 21:04</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 24.4.1 (<a href="http://orgmode.org">Org</a> mode 8.2.10)</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
