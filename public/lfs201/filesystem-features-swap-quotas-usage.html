<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>filesystem-features-swap-quotas-usage</title>
<!-- 2015-03-28 Sat 21:18 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">filesystem-features-swap-quotas-usage</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. Filesystem features - swap, quotas, usage</a>
<ul>
<li><a href="#sec-1-1">1.1. Objectives</a>
<ul>
<li><a href="#sec-1-1-1">1.1.1. Explain the concepts of swap and quotas</a></li>
<li><a href="#sec-1-1-2">1.1.2. Use the utilities that help manage quotas; quotacheck, quotaon, quatoaoff, edquota and quota</a></li>
<li><a href="#sec-1-1-3">1.1.3. Use the utilities df and du</a></li>
<li><a href="#sec-1-1-4">1.1.4. Many programs do not actually use all the memory they are given permission to use. Sometimes this is because child processes inherit a copy of the parent's memory regions utilizing a COW (Copy On Write) technique in which the child only obtains a unique copy (on a page by page basis) when there is a change.</a></li>
<li><a href="#sec-1-1-5">1.1.5. When memory pressure becomes important less active memory regions may be swapped out to disk, to be recalled only when needed again.</a></li>
<li><a href="#sec-1-1-6">1.1.6. mkswap - format a swap partition or file</a></li>
<li><a href="#sec-1-1-7">1.1.7. swapon - activate a swap partition or file</a></li>
<li><a href="#sec-1-1-8">1.1.8. swapoff - deactivate a swap partition or file</a></li>
</ul>
</li>
<li><a href="#sec-1-2">1.2. Quotas</a>
<ul>
<li><a href="#sec-1-2-1">1.2.1. quotacheck: generates and updates quota accounting files.</a></li>
<li><a href="#sec-1-2-2">1.2.2. quotaon: enable quota accounting</a></li>
<li><a href="#sec-1-2-3">1.2.3. quotaoff: disables quota accounting</a></li>
<li><a href="#sec-1-2-4">1.2.4. edquota: used for editing user or group quotas</a></li>
<li><a href="#sec-1-2-5">1.2.5. quota: reports on usage and limits</a></li>
</ul>
</li>
<li><a href="#sec-1-3">1.3. Setting up quotas</a></li>
<li><a href="#sec-1-4">1.4. Mount the filesystem with user/group quota options:</a>
<ul>
<li><a href="#sec-1-4-1">1.4.1. Add the usrquota and/or grpquota options to the filesystem entry in /etc/fstab</a></li>
<li><a href="#sec-1-4-2">1.4.2. Remount the filesystem (or mount if new)</a></li>
</ul>
</li>
<li><a href="#sec-1-5">1.5. Run quotacheck on the filesystem to setup quotas</a></li>
<li><a href="#sec-1-6">1.6. Enable quotas on the filesystem</a></li>
<li><a href="#sec-1-7">1.7. Set quotas with the edquota program.</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Filesystem features - swap, quotas, usage</h2>
<div class="outline-text-2" id="text-1">
<p>
Linux uses a robust swap space implementation through which the virtual memory system permits the apparent use of more memory than is physically available. 
Filesystem quotas can be used to administer user account usage of disk space. 
Utilities such as df and du enable easy monitoring of filesystem usage and capacities. 
</p>
</div>
<div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1"><span class="section-number-3">1.1</span> Objectives</h3>
<div class="outline-text-3" id="text-1-1">
</div><div id="outline-container-sec-1-1-1" class="outline-4">
<h4 id="sec-1-1-1"><span class="section-number-4">1.1.1</span> Explain the concepts of swap and quotas</h4>
</div>
<div id="outline-container-sec-1-1-2" class="outline-4">
<h4 id="sec-1-1-2"><span class="section-number-4">1.1.2</span> Use the utilities that help manage quotas; quotacheck, quotaon, quatoaoff, edquota and quota</h4>
</div>
<div id="outline-container-sec-1-1-3" class="outline-4">
<h4 id="sec-1-1-3"><span class="section-number-4">1.1.3</span> Use the utilities df and du</h4>
<div class="outline-text-4" id="text-1-1-3">
<p>
Linux employs a virtual memory system in which the operating system can function as if it had more memory than it really does. This kind of memory overcommission functions in two ways: 
</p>
</div>
</div>
<div id="outline-container-sec-1-1-4" class="outline-4">
<h4 id="sec-1-1-4"><span class="section-number-4">1.1.4</span> Many programs do not actually use all the memory they are given permission to use. Sometimes this is because child processes inherit a copy of the parent's memory regions utilizing a COW (Copy On Write) technique in which the child only obtains a unique copy (on a page by page basis) when there is a change.</h4>
</div>
<div id="outline-container-sec-1-1-5" class="outline-4">
<h4 id="sec-1-1-5"><span class="section-number-4">1.1.5</span> When memory pressure becomes important less active memory regions may be swapped out to disk, to be recalled only when needed again.</h4>
<div class="outline-text-4" id="text-1-1-5">
<p>
Such swapping is usually done to one or more dedicated partition or files; Linux permits multiple swap areas so the needs can be adjusted dynamically. Each area has a priority and lower priority areas are not used until higher priority areas are filled. 
In most situations the recommended swap size is the total RAM on the system. YOu can see what your system is currently using for swap areas with:
$ cat /proc/swaps 
and curent usage with:
$ free -o 
The only commands involving swaps are:
</p>
</div>
</div>
<div id="outline-container-sec-1-1-6" class="outline-4">
<h4 id="sec-1-1-6"><span class="section-number-4">1.1.6</span> mkswap - format a swap partition or file</h4>
</div>
<div id="outline-container-sec-1-1-7" class="outline-4">
<h4 id="sec-1-1-7"><span class="section-number-4">1.1.7</span> swapon - activate a swap partition or file</h4>
</div>
<div id="outline-container-sec-1-1-8" class="outline-4">
<h4 id="sec-1-1-8"><span class="section-number-4">1.1.8</span> swapoff - deactivate a swap partition or file</h4>
<div class="outline-text-4" id="text-1-1-8">
<p>
At any given time most memory is in use for caching file contents to prevent actually going to the disk any more than necessary, or in a sub-optimal order or timing. Such pages of memory are never swapped out as the backing store is the files themselves, so writing out to swap would be pointless; instead dirty pages (memory containing updated file contents that no longer reflect the stored data) are flushed out to disk. 
It is also worth pointing out that in linux memory used by the kernel itself, as opposed to application memory, is never swapped out, in distinction to some other operating systems. 
</p>
</div>
</div>
</div>
<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2"><span class="section-number-3">1.2</span> Quotas</h3>
<div class="outline-text-3" id="text-1-2">
<p>
Linux can use and enforce quotas on filesystems. Disk quotas allow administrators to control the maximum space particular users (or groups) are allowed. Considerable flexibility is allowed and quotas can be assigned on a per-filesystem basis. Protection is provided against a subset of users exhausting collective resources. 
These utilities help manage quotas:
</p>
</div>
<div id="outline-container-sec-1-2-1" class="outline-4">
<h4 id="sec-1-2-1"><span class="section-number-4">1.2.1</span> quotacheck: generates and updates quota accounting files.</h4>
</div>
<div id="outline-container-sec-1-2-2" class="outline-4">
<h4 id="sec-1-2-2"><span class="section-number-4">1.2.2</span> quotaon: enable quota accounting</h4>
</div>
<div id="outline-container-sec-1-2-3" class="outline-4">
<h4 id="sec-1-2-3"><span class="section-number-4">1.2.3</span> quotaoff: disables quota accounting</h4>
</div>
<div id="outline-container-sec-1-2-4" class="outline-4">
<h4 id="sec-1-2-4"><span class="section-number-4">1.2.4</span> edquota: used for editing user or group quotas</h4>
</div>
<div id="outline-container-sec-1-2-5" class="outline-4">
<h4 id="sec-1-2-5"><span class="section-number-4">1.2.5</span> quota: reports on usage and limits</h4>
<div class="outline-text-4" id="text-1-2-5">
<p>
Quota operations require the existence of the files aquota.user and aquota.group in the root directory of the filesystem using quotas. 
Quotas may be enabled or disabled on a per filesystem basis. In addition Linux supports the use of quotas based on user and group ids. 
Different filesystem types may have additional quota-related utilties, such as xfs<sub>quota</sub>. 
</p>
</div>
</div>
</div>
<div id="outline-container-sec-1-3" class="outline-3">
<h3 id="sec-1-3"><span class="section-number-3">1.3</span> Setting up quotas</h3>
<div class="outline-text-3" id="text-1-3">
<p>
To create a filesystem quota you must first make sure you have mounted the filesystem with the user and/or group quota mount options. Without these nothing else will work. The basic steps are: 
</p>
</div>
</div>
<div id="outline-container-sec-1-4" class="outline-3">
<h3 id="sec-1-4"><span class="section-number-3">1.4</span> Mount the filesystem with user/group quota options:</h3>
<div class="outline-text-3" id="text-1-4">
</div><div id="outline-container-sec-1-4-1" class="outline-4">
<h4 id="sec-1-4-1"><span class="section-number-4">1.4.1</span> Add the usrquota and/or grpquota options to the filesystem entry in /etc/fstab</h4>
</div>
<div id="outline-container-sec-1-4-2" class="outline-4">
<h4 id="sec-1-4-2"><span class="section-number-4">1.4.2</span> Remount the filesystem (or mount if new)</h4>
</div>
</div>
<div id="outline-container-sec-1-5" class="outline-3">
<h3 id="sec-1-5"><span class="section-number-3">1.5</span> Run quotacheck on the filesystem to setup quotas</h3>
</div>
<div id="outline-container-sec-1-6" class="outline-3">
<h3 id="sec-1-6"><span class="section-number-3">1.6</span> Enable quotas on the filesystem</h3>
</div>
<div id="outline-container-sec-1-7" class="outline-3">
<h3 id="sec-1-7"><span class="section-number-3">1.7</span> Set quotas with the edquota program.</h3>
<div class="outline-text-3" id="text-1-7">
<p>
Thus, to create a filesystem quota you must first make sure that you have mounted the filesystem with the user and/or group quota mount options. Without these, nothing else will work. 
First you need to put the right options in /etc/fstab as in: 
/dev/sda5 /home ext4 defaults,usrquota 1 1 
where we have assumed /home is on a dedicated partition. 
Then test with the following commands: 
$ sudo mount -o remount /home 
$ sudo quotacheck -vu /home
$ sudo quotaon -vu /home 
$ sudo edquota someusername
You may also want to set up grace periods with edquota. The mount optins that should be used in the /etc/fstab file are usrquota for user quotas and grpquota for group quotas. 
</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Created: 2015-03-28 Sat 21:18</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 24.4.1 (<a href="http://orgmode.org">Org</a> mode 8.2.10)</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
