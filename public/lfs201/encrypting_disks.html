<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>encrypting_disks</title>
<!-- 2015-03-18 Wed 07:25 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">encrypting_disks</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. Encrypting disks</a>
<ul>
<li><a href="#sec-1-1">1.1. Learning objectives</a>
<ul>
<li><a href="#sec-1-1-1">1.1.1. Provide sound resasons for using encryption and know when it is called for.</a></li>
<li><a href="#sec-1-1-2">1.1.2. Understand how LUKS operates through the use of cryptsetup</a></li>
<li><a href="#sec-1-1-3">1.1.3. Be able to set up and use encrypted filesystems and partitions</a></li>
<li><a href="#sec-1-1-4">1.1.4. Know how to configure the system to mount encrypted partitions at boot</a></li>
</ul>
</li>
<li><a href="#sec-1-2">1.2. Why use encryption?</a></li>
<li><a href="#sec-1-3">1.3. LUKS</a></li>
<li><a href="#sec-1-4">1.4. cryptsetup</a></li>
<li><a href="#sec-1-5">1.5. Using an Encrypted Partition</a></li>
<li><a href="#sec-1-6">1.6. Mounting at Boot</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Encrypting disks</h2>
<div class="outline-text-2" id="text-1">
</div><div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1"><span class="section-number-3">1.1</span> Learning objectives</h3>
<div class="outline-text-3" id="text-1-1">
</div><div id="outline-container-sec-1-1-1" class="outline-4">
<h4 id="sec-1-1-1"><span class="section-number-4">1.1.1</span> Provide sound resasons for using encryption and know when it is called for.</h4>
</div>
<div id="outline-container-sec-1-1-2" class="outline-4">
<h4 id="sec-1-1-2"><span class="section-number-4">1.1.2</span> Understand how LUKS operates through the use of cryptsetup</h4>
</div>
<div id="outline-container-sec-1-1-3" class="outline-4">
<h4 id="sec-1-1-3"><span class="section-number-4">1.1.3</span> Be able to set up and use encrypted filesystems and partitions</h4>
</div>
<div id="outline-container-sec-1-1-4" class="outline-4">
<h4 id="sec-1-1-4"><span class="section-number-4">1.1.4</span> Know how to configure the system to mount encrypted partitions at boot</h4>
</div>
</div>
<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2"><span class="section-number-3">1.2</span> Why use encryption?</h3>
<div class="outline-text-3" id="text-1-2">
<p>
Whenever sensitive data is being stored and trasnmitted. Configuring and using block device level encryption provides one of the strongest protections against harm caused by loss or compromise of data contained in hard drives and other media. 
Modern Linux distros offer the choice of encrypting all or some of your disk partitions during installation. It is also straightforward to create and format encrypted partitions at a later time, but you can not encrypt an already existing partition in place without a data copying operation. 
</p>
</div>
</div>
<div id="outline-container-sec-1-3" class="outline-3">
<h3 id="sec-1-3"><span class="section-number-3">1.3</span> LUKS</h3>
<div class="outline-text-3" id="text-1-3">
<p>
Modern Linux distros provide block device level encryption through the use of LUKS (Linux Unified Key Setup). Using block device encryption is highly recommended for portable systems such as laptops, tablets and smart phones. 
LUKS is installed on top of cryptsetup, a powerful utility that can also use other methods such as plain dm-crypt volumes, loop-AES and TrueCrypt-compatible format. We won't discuss these alternatives, as LUKS is the standard method most of used in linux. 
The dm-crypt kernel module uses the device mapper kernel infrastructure that is also heavily used by LVM, which is discussed later. 
Because LUKS stores all necessary information in the partition header itself, it is rather easy to migrate partitions to other disks or systems. 
LUKS can also be used to transparently encrypt swap partitions. 
</p>
</div>
</div>
<div id="outline-container-sec-1-4" class="outline-3">
<h3 id="sec-1-4"><span class="section-number-3">1.4</span> cryptsetup</h3>
<div class="outline-text-3" id="text-1-4">
<p>
Basically everything is done with the Swiss army knife program cryptsetup. Once encrypted volumes have been setup they can be mounted and unmounted with normal utilities. 
The general form of a command is: 
cryptsetup [OPTION&#x2026;]&lt;action&gt; &lt;action-specific&gt;
and a rather full listing of possibilities can be generated by: 
$ cryptsetup &#x2013;help
</p>
</div>
</div>
<div id="outline-container-sec-1-5" class="outline-3">
<h3 id="sec-1-5"><span class="section-number-3">1.5</span> Using an Encrypted Partition</h3>
<div class="outline-text-3" id="text-1-5">
<p>
If the LVM partition /dev/VG/MYSECRET already exists, the following commands will setup encryption, make it available to LUKS, format it, mount it, use it and umount it. 
First we need to give the partition to LUKS 
$ sudo cryptsetup luksFormat /dev/VG/MYSECRET
You will be prompted for a passphrase that will need to open use of the encrypted volume later. Note you only have to do this step once, when setting up encryption. 
You may have trouble here if your kernel does not use the method cryptsetup. Have a look at /proc/crypto to see methods that your system supports, and you can supply a method as in:
$ sudo cryptsetup luksFormat &#x2013;cipher aes /dev/VG/MYSECRET
You can make the volume available at any time with:
$ sudo cryptsetup &#x2013;verbose luksOpen /dev/VG/MYSECRET SECRET
where you will be prompted for the passphrase. You can format the partition:
$ sudo mkfs.ext4 /dev/mapper/SECRET
mount it: 
$ sudo mount /dev/mapper/SECRET /mnt
and then use to your heart's content just as if it were an unencrypted partition mounted at /mnt. When you are done, umount with:
$ sudo umount /mnt 
and then remove the mapper association for now, the partition will always be available for later use:
$ sudo cryptsetup &#x2013;verbose luksClose SECRET
</p>
</div>
</div>
<div id="outline-container-sec-1-6" class="outline-3">
<h3 id="sec-1-6"><span class="section-number-3">1.6</span> Mounting at Boot</h3>
<div class="outline-text-3" id="text-1-6">
<p>
To mount an encrypted partition at boot two conditions have to be satisfied:
</p>
<ol class="org-ol">
<li>Make an appropriate entry in /etc/fstab. There is nothing special about this and it does not refer to encryption in any way. 
</li>
<li>Add an entry to /etc/crypttab. This can be as simple as SECRET /dev/mapper/MYSECRET
</li>
</ol>
<p>
You can do more in this file, such as specifying the password if you don't want to be prompted at boot (which seems counter-productive security-wise). See man crypttab to find out what you can do with this file. 
</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Created: 2015-03-18 Wed 07:25</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 24.4.1 (<a href="http://orgmode.org">Org</a> mode 8.2.10)</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
