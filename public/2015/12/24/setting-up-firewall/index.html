<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <title>Setting up a firewall on Linux Ubuntu 14.04 - Kabads - musings, mutterings and murmerings</title>
  <meta property="og:title" content="Setting up a firewall on Linux Ubuntu 14.04 - Kabads - musings, mutterings and murmerings" />
  <meta name="twitter:title" content="Setting up a firewall on Linux Ubuntu 14.04 - Kabads - musings, …" />
  <meta name="description" content="Uses Firewalls allow only particular access to particular network ports and paths. You can remove access to a port or a specific IP address or a range of IP addresses.
Admins can apply rules according to what access they would like - these rules include both outgoing and incoming network traffic. This allows admins to build barriers of trust across machines.
Modern firewalls are based on Application Layer Firewalls and are aware of the kinds of applications and protocols that the connection is using.">
  <meta property="og:description" content="Uses Firewalls allow only particular access to particular network ports and paths. You can remove access to a port or a specific IP address or a range of IP addresses.
Admins can apply rules according to what access they would like - these rules include both outgoing and incoming network traffic. This allows admins to build barriers of trust across machines.
Modern firewalls are based on Application Layer Firewalls and are aware of the kinds of applications and protocols that the connection is using.">
  <meta name="twitter:description" content="Uses Firewalls allow only particular access to particular network ports and paths. You can remove access to a port or a specific IP address or a range of IP addresses.
Admins can apply rules according …">
  <meta name="author" content=""/>
  <meta property="og:site_name" content="Kabads - musings, mutterings and murmerings" />
  <meta property="og:url" content="/2015/12/24/setting-up-firewall/" />
  <meta property="og:type" content="article" />
  <meta name="twitter:card" content="summary" />
  <meta name="generator" content="Hugo 0.42.2" />
  <link rel="stylesheet" href="/css/style.css" media="all" />
  <link rel="stylesheet" href="/css/syntax.css" media="all" />
  <link rel="stylesheet" href="/css/custom.css" media="all" />
  <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
</head>
<body>

<header class="site-header">
  <nav class="site-navi">
    <h1 class="site-title"><a href="/">Kabads - musings, mutterings and murmerings</a></h1>
    <ul class="site-navi-items">
      <li class="site-navi-item-categories"><a href="/categories/" title="Categories">Categories</a></li>
      <li class="site-navi-item-about"><a href="/about/" title="About">About</a></li>
    </ul>
  </nav>
</header>
<hr class="site-header-bottom">

  <div class="main" role="main">
    <article class="article">
      
      
      <h1 class="article-title">Setting up a firewall on Linux Ubuntu 14.04</h1>
      
      <hr class="article-title-bottom">
      <ul class="article-meta">
        <li class="article-meta-date"><time>December 24, 2015</time></li>
        <li class="article-meta-categories">
          <a href="/categories/sysadmin/">
            <svg class="icon"><use xlink:href="/images/fa-solid.svg#folder"></use></svg>
            sysadmin
          </a>&nbsp;
        </li>
      </ul>
      
<aside class="toc">
  <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#uses">Uses</a></li>
<li><a href="#set-up">Set up</a>
<ul>
<li><a href="#zones">Zones</a></li>
<li><a href="#services-and-ports-within-a-zone">Services and ports within a zone</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
</aside>
      

<h2 id="uses">Uses</h2>

<p>Firewalls allow only particular access to particular network ports and paths. You can remove access to a port or a specific IP address or a range of IP addresses.</p>

<p>Admins can apply rules according to what access they would like - these rules include both outgoing and incoming network traffic. This allows admins to build barriers of trust across machines.</p>

<p>Modern firewalls are based on <a href="https://en.wikipedia.org/wiki/Application_firewall"><em>Application Layer Firewalls</em></a> and are aware of the kinds of applications and protocols that the connection is using. They can block anything which is not part of the normal flow of traffic.</p>

<h2 id="set-up">Set up</h2>

<p>The <strong>firewalld</strong> package needs to be installed:</p>

<pre><code>$ sudo aptitude install firewalld 
</code></pre>

<p>You should not run the program <strong>iptables</strong> alongside <strong>firewalld</strong> as this is the older version and will create a conflict.</p>

<p><strong>firewalld</strong> is a service which needs to be running to use and configure the firewall, and is started in the usual way.</p>

<pre><code>$ sudo /etc/init.d/firewalld start 
</code></pre>

<p>You can test if the service is running with:</p>

<pre><code>$ sudo firewall-cmd --state
</code></pre>

<p>If you have more than one network interface on IPV4, you will need to turn on <strong>ip forwarding</strong>. This is achieved with:</p>

<pre><code>$ sudo sysctl net.ipv4.ip_forward=1
</code></pre>

<p>However, this is not persistent across boots. To achieve this, you will need to add the following line to <em>/etc/sysctl.conf</em>:</p>

<pre><code>net.ipv4.ip_forward=1 
</code></pre>

<p>and then reboot or type:</p>

<pre><code>$ sudo sysctl -p 
</code></pre>

<p>to read in the new setting.</p>

<h3 id="zones">Zones</h3>

<p>Firewalls work with <strong>zones</strong> each which has a level of trust defined. The zones are</p>

<ul>
<li><strong>drop</strong> - only particular incoming connections are allowed</li>
<li><strong>block</strong> - all incoming connections are rejected</li>
<li><strong>public</strong> - do not trust any computers on the network; only defined incoming connections are permitted</li>
<li><strong>external</strong> - used when <em>masquerading</em> is being used, usually in routers.</li>
<li><strong>dmz</strong> - used when access is allowed only to some services to the public.</li>
<li><strong>work</strong> - trust connected nodes to be not harmful</li>
<li><strong>home</strong> - mostly trust other network nodes, but still select which incoming connections are allowed</li>
<li><strong>internal</strong> - similar to work zone</li>
<li><strong>trusted</strong> - everything is allowed.</li>
</ul>

<p>On installation, nearly all Linux distributions will select the <strong>public</strong> zone as the default for all interfaces.</p>

<p>Get the default zone:</p>

<pre><code>$ sudo firewall-cmd --get-default-zone
</code></pre>

<p>Obtain a list of zones being used:</p>

<pre><code>$ sudo firewall-cmd --get-active-zones 
</code></pre>

<p>List all available zones:</p>

<pre><code>$ sudo firewall-cmd --get-zones 
</code></pre>

<p>To change the default zone to <strong>trusted</strong> and then change it back.</p>

<pre><code>$ sudo firewall-cmd --set-default-zone=trusted

$ sudo firewall-cmd --set-default-zone=public
</code></pre>

<p>To assign an interface temporarily to a particular zone:</p>

<pre><code>$ sudo firewall-cmd --zone=internal --change-interface=eth0
</code></pre>

<p>This will only change the interface until the next boot. To make it permanent, we add the <strong>&ndash;permanent</strong> flag.</p>

<pre><code>$ sudo firewall-cmd --permanent --zone=internal --change-interface=eth0
</code></pre>

<p>which will create a file in <strong>/etc/firewalld/zones/internal.xml</strong>.</p>

<p>To ascertain the zone associated with a particular interface:</p>

<pre><code>$ sudo firewall-cmd --get-zone-of-interface=eth0
</code></pre>

<p>To get the details of a particular zone:</p>

<pre><code>$ sudo firewall-cmd --zone=public --list-all 
</code></pre>

<p>An admin can also bind a zone to a network address (as well as an interface).</p>

<p>To bind a source to a zone:</p>

<pre><code>$ sudo firewall-cmd --permanent --zone=trusted --add-source=192.168.1.0/24
</code></pre>

<p>With this command, anyone from address 192.168.1.x will be added to the <strong>trusted</strong> zone.</p>

<h3 id="services-and-ports-within-a-zone">Services and ports within a zone</h3>

<p>Setting zones is now possible, but for these to become effective, we need to set particular services within each zone.</p>

<p>We can see what services are associated with a particular zone:</p>

<pre><code>$ sudo firewall-cmd --list-services --zone=public
</code></pre>

<p>To add a service to a zone:</p>

<pre><code>$ sudo firewall-cmd --permanent --zone=work --add-service=http
$ sudo firewall-cmd --reload 
</code></pre>

<p><strong>&ndash;reload</strong> is required to make the change effective and <strong>&ndash;permanent</strong> is required to add a service to a zone.</p>

<p>Port management is very similar:</p>

<pre><code>$ sudo firewall-cmd --zone=work --add-port=21/tcp
$ sudo firewall-cmd --reload 
</code></pre>

<p>You can also remove these with the commands <strong>&ndash;remove-service</strong> and <strong>&ndash;remove-port</strong>.</p>

    </article>

    
<ul class="article-share">
  <li>
    <a href="https://twitter.com/share" class="twitter-share-button">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
  </li>
  <li>
    <div class="fb-share-button" data-href="https://kabads.monkeez.org/2015/12/24/setting-up-firewall/" data-layout="button_count" data-action="like" data-size="small" data-show-faces="true" data-share="true"></div>
    <div id="fb-root"></div>
    <script>(function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s); js.id = id;
      js.src = "//connect.facebook.net/ja_JP/sdk.js#xfbml=1&version=v2.10";
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));</script>
  </li>
  <li>
    <script src="https://apis.google.com/js/platform.js" async defer></script>
    <g:plus action="share"></g:plus>
  </li>
  <li>
    <a href="http://b.hatena.ne.jp/entry/" class="hatena-bookmark-button" data-hatena-bookmark-layout="basic-label-counter" data-hatena-bookmark-lang="en" title="このエントリーをはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a><script src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
  </li>
  <li>
    <a data-pocket-label="pocket" data-pocket-count="horizontal" class="pocket-btn" data-lang="en"></a>
    <script>!function(d,i){if(!d.getElementById(i)){var j=d.createElement("script");j.id=i;j.src="https://widgets.getpocket.com/v1/j/btn.js?v=1";var w=d.getElementById(i);d.body.appendChild(j);}}(document,"pocket-btn-js");</script>
  </li>
</ul>

    <ul class="pager article-pager">
      <li class="pager-newer">
          <a href="/2016/01/24/bash-find-command/" data-toggle="tooltip" data-placement="top" title="Bash find command">&lt; Newer</a>
      </li>
      <li class="pager-older">
        <a href="/2015/12/22/how-to-enable-disk-quotas-linux/" data-toggle="tooltip" data-placement="top" title="How to enable disk quotas for users">Older &gt;</a>
      </li>
    </ul>
  </div>


<div class="site-footer">
  <div class="copyright"></div>
  <ul class="site-footer-items">
  </ul>
  <div class="powerdby">
    Powered by <a href="https://gohugo.io/">Hugo</a>
  </div>
</div>
<script src="/js/script.js"></script>
<script src="/js/custom.js"></script>


</body>
</html>
