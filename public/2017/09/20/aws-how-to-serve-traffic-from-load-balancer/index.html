<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="pinterest" content="nopin">
<meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
<meta name="generator" content="Hugo 0.36" />



<link rel="canonical" href="https://kabads.monkeez.org/2017/09/20/aws-how-to-serve-traffic-from-load-balancer/">


    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/solarized_dark.min.css">
    <title>AWS - How to Serve Traffic from a Load Balancer - Kabads - musings, mutterings and murmerings</title>
    
<meta name="description" content="Amazon Web Services (AWS) allows you to serve private network traffic from behind a public load balancer. This offers extra security benefits as it detects DDOS traffic and other exploits and offers a layer of protection.There are some things you should know before you start this tutorial. You should know: How to create a VPC How to configure subnets How to create an EC2 instance How to ensure an EC2 instance is within an particular subnet How to ssh to an EC2 instance  You will create a new VPC.">

<meta property="og:title" content="AWS - How to Serve Traffic from a Load Balancer - Kabads - musings, mutterings and murmerings">
<meta property="og:type" content="article">
<meta property="og:url" content="https://kabads.monkeez.org/2017/09/20/aws-how-to-serve-traffic-from-load-balancer/">
<meta property="og:image" content="https://kabads.monkeez.org/images/default.png">
<meta property="og:site_name" content="Kabads - musings, mutterings and murmerings">
<meta property="og:description" content="Amazon Web Services (AWS) allows you to serve private network traffic from behind a public load balancer. This offers extra security benefits as it detects DDOS traffic and other exploits and offers a layer of protection.There are some things you should know before you start this tutorial. You should know: How to create a VPC How to configure subnets How to create an EC2 instance How to ensure an EC2 instance is within an particular subnet How to ssh to an EC2 instance  You will create a new VPC.">
<meta property="og:locale" content="ja_JP">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="Kabads - musings, mutterings and murmerings">
<meta name="twitter:url" content="https://kabads.monkeez.org/2017/09/20/aws-how-to-serve-traffic-from-load-balancer/">
<meta name="twitter:title" content="AWS - How to Serve Traffic from a Load Balancer - Kabads - musings, mutterings and murmerings">
<meta name="twitter:description" content="Amazon Web Services (AWS) allows you to serve private network traffic from behind a public load balancer. This offers extra security benefits as it detects DDOS traffic and other exploits and offers a layer of protection.There are some things you should know before you start this tutorial. You should know: How to create a VPC How to configure subnets How to create an EC2 instance How to ensure an EC2 instance is within an particular subnet How to ssh to an EC2 instance  You will create a new VPC.">
<meta name="twitter:image" content="https://kabads.monkeez.org/images/default.png">


<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "NewsArticle",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id":"https://kabads.monkeez.org/"
    },
    "headline": "AWS - How to Serve Traffic from a Load Balancer - Kabads - musings, mutterings and murmerings",
    "image": {
      "@type": "ImageObject",
      "url": "https://kabads.monkeez.org/images/default.png",
      "height": 800,
      "width": 800
    },
    "datePublished": "2017-09-20T00:00:00JST",
    "dateModified": "2017-09-20T00:00:00JST",
    "author": {
      "@type": "Person",
      "name": "Kabads - musings, mutterings and murmerings"
    },
    "publisher": {
      "@type": "Organization",
      "name": "Kabads - musings, mutterings and murmerings",
      "logo": {
        "@type": "ImageObject",
        "url": "https://kabads.monkeez.org/images/logo.png",
        "width": 600,
        "height": 60
      }
    },
    "description": "Amazon Web Services (AWS) allows you to serve private network traffic from behind a public load balancer. This offers extra security benefits as it detects DDOS traffic and other exploits and offers a layer of protection.
There are some things you should know before you start this tutorial. You should know:
 How to create a VPC How to configure subnets How to create an EC2 instance How to ensure an EC2 instance is within an particular subnet How to ssh to an EC2 instance  You will create a new VPC."
  }
</script>


    <link href="https://kabads.monkeez.org/css/styles.css" rel="stylesheet">
    

  </head>

  <body>
    
    
    

    <header class="l-header">
      <nav class="navbar navbar-default">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://kabads.monkeez.org/">Kabads - musings, mutterings and murmerings</a>
          </div>

          

        </div>
      </nav>
    </header>

    <main>
      <div class="container">
        
<div class="row">
  <div class="col-md-8">

    <nav class="p-crumb">
      <ol class="breadcrumb">
        <li><a href="https://kabads.monkeez.org/"><i class="fa fa-home" aria-hidden="true"></i></a></li>
        
        <li itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb"><a href="https://kabads.monkeez.org/post/" itemprop="url"><span itemprop="title">post</span></a></li>
        
        <li class="active">AWS - How to Serve Traffic from a Load Balancer</li>
      </ol>
    </nav>

    <article class="single">
  <header>
    <ul class="p-facts">
      <li><i class="fa fa-calendar" aria-hidden="true"></i><time datetime="2017-09-20T00:00:00JST">Sep 20, 2017</time></li>
      <li><i class="fa fa-bookmark" aria-hidden="true"></i><a href="https://kabads.monkeez.org/post/">post</a></li>
      
    </ul>

    <h1 class="title">AWS - How to Serve Traffic from a Load Balancer</h1>
  </header>

  

  <div class="article-body"><p><a href="http://aws.amazon.com">Amazon Web Services</a> (AWS) allows you to serve private network traffic from behind a public load balancer. This offers extra security benefits as it detects DDOS traffic and other exploits and offers a layer of protection.</p>

<p>There are some things you should know before you start this tutorial. You should know:</p>

<ol>
<li>How to create a <a href="https://en.wikipedia.org/wiki/Virtual_private_cloud">VPC</a></li>
<li>How to configure <a href="https://en.wikipedia.org/wiki/Subnetwork">subnets</a></li>
<li>How to create an EC2 instance</li>
<li>How to ensure an EC2 instance is within an particular subnet</li>
<li>How to ssh to an EC2 instance</li>
</ol>

<p>You will create a new VPC. You can use your default VPC, but this isn&rsquo;t recommended. Default VPCs are for legacy ec2-classic instances. You should identify a CIDR block range for your VPC (e.g. 10.0.0.0/16).</p>

<p>Then, create two new subnets under the new VPC. One will be private and one will be public. The load balancer will use the public subnet and the EC2 instance will use the private subnet. Each subnet will have a different route table, one allowing traffic in and the other not. The first subnet should have a CIDR block range of 10.0.1.0/24. Next create your private subnet with a CIDR of 10.0.2.0/24 - this can be in the same availibility zone as the first subnet.</p>

<p>For high availability, it is a good idea to place your next elastic load balancer in a different availability zone. When you configure your load balancer you will need to choose two subnets. Therefore we have to create another public subnet that has a different availability zone. This has a CIDR range of 10.0.3.0/24 and is belongs in a different availability zone.</p>

<p>You should have three subnets as this image shows.</p>

<p><blockquote class="imgur-embed-pub" lang="en" data-id="a/KFrjH"><a href="//imgur.com/KFrjH"></a></blockquote><script async src="//s.imgur.com/min/embed.js" charset="utf-8"></script></p>

<p>Next you need to create an Internet Gateway and attach it to the public subnet. This is what makes the load balancer  world accessible. Click on Internet Gateway, then create an internet gateway, with a name tag. Then, attach it to the VPC that you have created (only one Internet Gateway can be attached to a VPC). Click the Attach to VPC button and then choose the new VPC that you created earlier. This means you will be able to access the EC2 instance for the time being.</p>

<p>Next add a route table. Create a Route Table and add a route of 0.0.0.0/0 and choose the target of your new Internet Gateway. This means you can now access your EC2 instance.</p>

<p>This route table is associated with all of the subnets, which means they are all now public. We will later make the private subnet private.</p>

<p>Now, create your EC2 instance. Launch it in the private subnet (even though it is still public at the moment).</p>

<p>When you create your EC2 instance create a rule that allows port 80 for HTTP.</p>

<p>Now create a load balancer. This will be a classic type of load balancer. Do not create an internal load balancer, as that will only be accessible from within the VPC. We want traffic from anywhere. Listen on port 80. Now we select the two public subnets that we created earlier. One of them has to be in the same availability zone as the EC2 instance (which it is). The other one can be in a different availibility zone. Assign the security group that was created when you created the VPC.</p>

<p>With load balancers you have to configure the health check. This is best done over TCP protocol on port 22. Then you add an EC2 instance to the load balancer. Use the one that we created earlier. Add tags, review and launch.</p>

<p>Now we need to SSH in to the instance and install a httpd server. ssh in using your key, ssh -i pem-key.pem ec2-user@34.3.124.41 - do not forget that your pem key file must have permissions of 400 or less.</p>

<p>Start the httpd service - sudo service start httpd</p>

<p>Check using the public ip address of the EC2 instance. You&rsquo;ll notice that this works as the EC2 instance is still in a public route table.</p>

<p>Let&rsquo;s fix that by creating a new route table. The new route table must only have a route that allows the local traffic (i.e. no 0.0.0.0/0). Then go to the private subnet and then change the route for the subnet to the new route table that doesn&rsquo;t have a public route.</p>

<p><blockquote class="imgur-embed-pub" lang="en" data-id="a/CzkdB"><a href="//imgur.com/CzkdB"></a></blockquote><script async src="//s.imgur.com/min/embed.js" charset="utf-8"></script></p>

<p>You can test if your load balancer is still forwarding the traffic by clicking on load balancer link, selecting the active load balancer and then using the DNS information</p>

<p><blockquote class="imgur-embed-pub" lang="en" data-id="a/mPIkP"><a href="//imgur.com/mPIkP"></a></blockquote><script async src="//s.imgur.com/min/embed.js" charset="utf-8"></script></p>

<p>Copy and paste that link into your browser. You should be forwarded to the HTTP welcome page that the private EC2 instance is server.</p>

<p>If you have any comments, please post them in the disqus below.</p>
</div>

  <footer class="article-footer">
    
    
    
    <section class="bordered">
      <header>
        <div class="panel-title">CATEGORIES</div>
      </header>
      <div>
        <ul class="p-terms">
          
          <li><a href="https://kabads.monkeez.org/categories/sysadmin/">sysadmin</a></li>
          
        </ul>
      </div>
    </section>
    
    
    
    
  </footer>

</article>


    
  </div>

  <div class="col-md-4">
    
<aside class="l-sidebar">

  <section class="panel panel-default">
    <div class="panel-heading">
      <div class="panel-title">LATESTS</div>
    </div>
    <div class="list-group">
      
      <a href="https://kabads.monkeez.org/post/2018-02-11-cycle-jaunt-around-bath/" class="list-group-item">2018 02 11 Cycle Jaunt Around Bath</a>
      
      <a href="https://kabads.monkeez.org/2017/10/03/aws-how-to-automatically-launch-apache-with-your-site-content/" class="list-group-item">How to create an instance that pulls your website content automatically</a>
      
      <a href="https://kabads.monkeez.org/2017/09/20/how-to-create-a-vpc/" class="list-group-item">AWS - How to Create A VPC</a>
      
      <a href="https://kabads.monkeez.org/2017/09/20/aws-how-to-serve-traffic-from-load-balancer/" class="list-group-item">AWS - How to Serve Traffic from a Load Balancer</a>
      
      <a href="https://kabads.monkeez.org/2017/07/02/swindon-to-goring-walk/" class="list-group-item">TADS walk Swindon to Goring</a>
      
      <a href="https://kabads.monkeez.org/2017/06/10/how-to-install-lineageos-wileyfox-swift/" class="list-group-item">How to install LineageOS on Wileyfox Swift</a>
      
      <a href="https://kabads.monkeez.org/2017/05/06/a-cartoon-about-file-permissions/" class="list-group-item">A Cartoon About File Permissions</a>
      
      <a href="https://kabads.monkeez.org/2017/01/29/setting-up-lets-encrypt-with-certauto/" class="list-group-item">Setting up SSL Certificates with Lets Encrypt and certbot</a>
      
      <a href="https://kabads.monkeez.org/2016/12/10/running-ec2-instance/" class="list-group-item">Running EC2 Instance</a>
      
      <a href="https://kabads.monkeez.org/2016/11/20/finding-large-files-in-a-directory/" class="list-group-item">Finding large files in a directory</a>
      
    </div>
  </section>

  
  <section class="panel panel-default">
    <div class="panel-heading">
      <div class="panel-title">CATEGORY</div>
    </div>
    <div class="list-group">
      
      <a href="https://kabads.monkeez.org/categories/sysadmin" class="list-group-item">sysadmin</a>
      
      <a href="https://kabads.monkeez.org/categories/cycling" class="list-group-item">cycling</a>
      
      <a href="https://kabads.monkeez.org/categories/education" class="list-group-item">education</a>
      
      <a href="https://kabads.monkeez.org/categories/exercise" class="list-group-item">exercise</a>
      
      <a href="https://kabads.monkeez.org/categories/leisure" class="list-group-item">leisure</a>
      
      <a href="https://kabads.monkeez.org/categories/reading" class="list-group-item">reading</a>
      
      <a href="https://kabads.monkeez.org/categories/tech" class="list-group-item">tech</a>
      
    </div>
  </section>
  
  <section class="panel panel-default">
    <div class="panel-heading">
      <div class="panel-title">TAG</div>
    </div>
    <div class="list-group">
      
      <a href="https://kabads.monkeez.org/tags/ict" class="list-group-item">ict</a>
      
    </div>
  </section>
  

</aside>


  </div>
</div>

      </div>
    </main>

    <footer class="l-footer">
      <div class="container">
        <p><span class="h-logo">&copy; Kabads - musings, mutterings and murmerings</span></p>
        <aside>
          <p>Powered by <a href="https://gohugo.io/">Hugo</a>.</p>
          <p><a href="https://github.com/dim0627/hugo_theme_beg">Beg</a> designed by <a href="http://yet.unresolved.xyz/">Daisuke Tsuji</a>.</p>
        </aside>
      </div>
    </footer>

    <script src="//code.jquery.com/jquery-3.1.1.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>

